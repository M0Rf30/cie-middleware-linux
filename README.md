<div align="center">
  <img src="data/app.m0rf30.cieid.svg" alt="App Logo" height="200" />
  <!-- Spacer -->
  <br /><br />

  <!-- Centered language switcher -->
  <p>
    <a href="./README.en.md">English</a> |
    <a href="./README.md">Italiano</a>
  </p>
  <h1 align="center">Software per la Carta d'Identità Elettronica</h1>
    <!-- Build status badges -->
    <p>
        <img src="https://github.com/M0Rf30/cie-middleware-linux/actions/workflows/main.yml/badge.svg" alt="Build Status">
        <img src="https://camo.githubusercontent.com/a0d5fcf1fd221b8e41e16be6e987c6646948e007eec757b70f51470fa64e2d9d/68747470733a2f2f696d672e736869656c64732e696f2f62616467652f7061636b61676564253230776974682d7961702d6f72616e67653f75726c3d68747470733a2f2f6c656674266c696e6b3d6769746875622e636f6d2f7061636b616765666f756e646174696f6e2f796170266c6f676f3d646174613a696d6167652f7376672b786d6c3b6261736536342c5044393462577767646d567963326c76626a30694d5334774969426c626d4e765a476c755a7a3069565652474c546769507a344b50484e325a79426a6247467a637a306959334e7a4c5446714f4738324f475969494864705a48526f505349794f5449754e546b694947686c6157646f644430694d6a557a4c6a5532496942325a584a7a61573975505349784c6a456949485a705a58644362336739496a41674d4341794e6a41674d6a49314c6a4d794969423462577875637a30696148523063446f764c336433647935334d793576636d63764d6a41774d43397a646d636950676f385a794230636d467563325a76636d3039496d316864484a70654367794c6a63784e5455674d434177494449754d7a55304f5341744e5334334e6941744e5334774f4455344b5349675a6d6c7362443069497a526c59324e684d79492b436a78775958526f49475139496d30324c6a6378494455344c6a5133494463754d5463674d5334794e6d457a4e7934784e53417a4e7934784e534177494441674d43417a4c6a63674f4334354d3277744e4334784f434132595455754e5445674e5334314d534177494441674d4341774c6a59674e7934774d6d77304c6a4d674e43347a595455754e5445674e5334314d534177494441674d4341334c6a4132494441754e6a46734e6930304c6a453459544d334c6a453049444d334c6a4530494441674d434177494467754f544d674d793433624445754d6a59674e7934784e3245314c6a5578494455754e5445674d434177494441674e5334304e5341304c6a553261445a684e5334314d5341314c6a5578494441674d434177494455754e444d744e4334314e6d77784c6a49324c5463754d5464684d7a63754d69417a4e793479494441674d434177494467754f544d744d7934334d577732494451754d5468684e5334314d5341314c6a5578494441674d434177494463754d4459744d4334314f4777304c6a4d744e43347a595455754e5445674e5334314d534177494441674d4341774c6a59784c5463754d445a734c5451754d5467744e6d457a4e79347849444d334c6a45674d434177494441674d7934334c5467754f544e734e7934784e7930784c6a4932595455754e5445674e5334314d534177494441674d4341304c6a55334c5455754e4456324c545a684e5334314d5341314c6a5578494441674d4341774c5451754e5459744e5334304d3277744e7934784e7930784c6a493259544d334c6a457a49444d334c6a457a494441674d4341774c544d754e7930344c6a6b7a624451754d5467744e6d45314c6a5578494455754e5445674d434177494441744d4334324c5463754d445a734c5451754d7a49744e43347a4d6d45314c6a5578494455754e5445674d434177494441744e7934774e6930774c6a597962433032494451754d5468684d7a63754d5449674d7a63754d5449674d434177494441744f4334354d79307a4c6a6378624330784c6a49794c5463754d5452684e5334314d5341314c6a5578494441674d4341774c5455754e4463744e4334314e5767744e6d45314c6a5578494455754e5445674d434177494441744e5334304d7941304c6a5532624330784c6a4932494463754d5464684d7a63754d446b674d7a63754d446b674d434177494441744f4334354d79417a4c6a6378624330324c5451754d5468684e5334314d5341314c6a5578494441674d4341774c5463754d4459674d4334324d6d77744e43347a4d6941304c6a4934595455754e5445674e5334314d534177494441674d4330774c6a5978494463754d445a734e4334784f43413259544d334c6a453349444d334c6a4533494441674d4341774c544d754e7941344c6a6b7a624330334c6a4532494445754d6a4a684e5334314d5341314c6a5578494441674d4341774c5451754e5459674e5334304e335932595455754e5445674e5334314d534177494441674d4341304c6a5532494455754e446436625449304c6a59314c5449334c6a46684d6a59754d7a55674d6a59754d7a55674d434178494445674d43417a4e7934794f4341794e6934784f5341794e6934784f534177494441674d5341774c544d334c6a4934656d30784e7934774e5341784d5334794e5330314c6a55304c5445774c6a4131595445344c6a6730494445344c6a6730494441674d434178494449304c6a5532494449304c6a5533624330784d4330314c6a5530595463754e544d674e7934314d794177494441674d4330354c546c36625445754e546b674e5745794c6a5178494449754e4445674d434177494445674d5334334d5341304c6a4579494449754e4463674d6934304e794177494441674d53307a4c6a5179494441674d6934304d6941794c6a5179494441674d434178494445754e7a45744e4334784e5870744c54457a4c6a4d79494445314c6a64684d5467754f4459674d5467754f4459674d434177494445744e4334784d5330794d4334304e5777784d4341314c6a5530595463754e5455674e7934314e534177494441674d43413549446c734e5334314e4341784d4745784f4334344e7941784f4334344e794177494441674d5330794d4334304d7930304c6a41356569497650676f384c32632b436a777663335a6e50676f3d" alt="Custom Badge">
    </p>
</div>

## Descrizione

Questa libreria software (middleware) implementa le interfacce crittografiche
standard **PKCS#11** e **CSP**, consentendo l'utilizzo del certificato di
autenticazione e della relativa chiave privata memorizzati sul chip della CIE.

## Componenti

La [libreria](libcie-pkcs11) è sviluppata in C++ e supporta OS GNU/Linux.

La parte di [interfaccia grafica](cie-java) è sviluppata in Java.

## Installazione

[Qui](https://github.com/M0Rf30/cie-middleware-linux/releases) puoi trovare i
binari generati da questo repo, per le seguenti distro GNU/Linux:

- Arch Linux [qui](https://aur.archlinux.org/packages/cie-middleware-git)
- Rocky 9
- Ubuntu 22.04

Inoltre puoi installare il pacchetto Flatpak utilizzando il file manifest fornito.

## Generazione Flatpak dal Manifest

Questa guida descrive i passaggi necessari per creare un pacchetto Flatpak utilizzando il file manifest fornito.

### Prerequisiti

Prima di procedere, assicurati di avere installato i seguenti software sul tuo sistema:

- [Flatpak](https://flatpak.org/setup/)
- [flatpak-builder](https://docs.flatpak.org/en/latest/flatpak-builder.html)

### Istruzioni

```sh
cie-java/gradlew -b cie-java/build.gradle standalone
cp cie-java/build/libs/CIEID-standalone.jar packages/flatpak

flatpak remote-add --if-not-exists --user flathub https://dl.flathub.org/repo/flathub.flatpakrepo
flatpak-builder --force-clean --user --install-deps-from=flathub --repo=repo --install build-dir packages/flatpak/app.m0rf30.cieid.yml
```

Puoi eseguire il pacchetto Flatpak installato con il seguente comando:

```sh
flatpak run --user app.m0rf30.cieid
```

## Compilazione

### Requisiti

Sono necessarie le seguenti librerie:

- crypto++
- curl
- fontconfig
- freetype2
- java (>= 17)
- jdk (>= 17) (make)
- libpng
- libxml2
- meson (make)
- ninja (make)
- openssl
- pcsclite
- pkgconf (make)
- podofo (<= 0.10.4)

### Istruzioni

Da terminale, spostarsi nella root del presente repo e digitare:

```sh
cie-java/gradlew -b cie-java/build.gradle standalone

meson setup builddir libs
meson configure -Dprefix=/usr builddir
meson compile -C builddir
```

alla fine della build saranno presenti i file:

- builddir/libcie-pkcs11.so
- cie-java/build/libs/CIEID-standalone.jar

## Uso nel browser

Per utilizzare la libreria con i seguenti browser:

- basati su Mozilla Firefox
- basati su Google Chromium

Segui le relative istruzioni sottostanti.

**NOTA BENE**: nel browser vengono sempre richieste
le ultime 4 cifre del pin.

### Browser basati su Mozilla Firefox

Segui le istruzioni riportate nella UI di Cie ID, cliccando
sul pulsante `Tutorial`.

### Browser basati su Google Chromium

Aprire un terminale e digitare:

```sh
modutil -dbdir sql:$HOME/.pki/nssdb -add CIE -libfile /usr/lib/libcie-pkcs11.so

# Verifica della libreria aggiunta
modutil -dbdir sql:$HOME/.pki/nssdb -list
```
